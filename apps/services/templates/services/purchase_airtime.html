{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">

<style>
/* Your styles here (no change) */
</style>

<div class="container">
    <h1>Purchase Airtime</h1>

    <form id="purchase-airtime-form" method="post" action="{% url 'purchase_airtime' %}">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="network_provider">Select Network Provider:</label>
            <select id="network_provider" name="network_provider">
                {% for provider in network_providers %}
                    <option value="{{ provider.value }}" {% if provider.value == network_provider %}selected{% endif %}>
                        {{ provider.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="network-logo">
            {% for provider in network_providers %}
                {% if provider.value == network_provider %}
                    <img src="{{ provider.logo }}" alt="{{ provider.name }} Logo" width="150">
                {% endif %}
            {% endfor %}
        </div>

        <div class="categories-grid">
            {% for category in categories %}
            <div 
                id="category-{{ category.amount }}" 
                class="category-card" 
                onclick="selectCategory('{{ category.amount }}', '{{ network_provider }}')">
                <h4>{{ category.category }}</h4>
                <p>â‚¦{{ category.amount }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="amount-field-container">
            <input 
                type="number" 
                id="amount" 
                name="amount" 
                value="{{ categories.0.amount }}" 
                placeholder="Enter amount" 
                min="1" 
                required>
            <button type="submit">Pay</button>
        </div>

        <div class="form-group">
            <label for="phone_number">Enter Phone Number:</label>
            <input type="text" id="phone_number" name="phone_number" required>
        </div>

        <div class="form-group">
            <label for="payment_method">Select Payment Method:</label>
            <select id="payment_method" name="payment_method">
                <option value="wallet">Wallet</option>
                <option value="debit_card">Debit Card</option>
            </select>
        </div>

        <div id="loading-spinner" style="display: none;">Loading...</div>
    </form>
</div>

<script>
document.getElementById('purchase-airtime-form').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const formData = new FormData(this);
    const spinner = document.getElementById("loading-spinner");

    spinner.style.display = "block";

    fetch("{% url 'purchase_airtime' %}", {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        spinner.style.display = "none";
        if (data.status === 'success') {
            alert(data.message);
            window.location.reload(); // reload page or redirect to success page
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        spinner.style.display = "none";
        console.error('Error:', error);
        alert('Something went wrong. Please try again.');
    });
});


</script>

{% endblock %}