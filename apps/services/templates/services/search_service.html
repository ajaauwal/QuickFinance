{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- Search Bar -->
<div class="position-relative">
    <input type="text" id="search-box" class="form-control" placeholder="Search services..." autocomplete="off">
    <div id="search-results" class="dropdown-menu w-100" style="display:none;"></div>
</div>

<!-- JavaScript for Real-Time Search -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const searchBox = document.getElementById("search-box");
    const searchResults = document.getElementById("search-results");

    searchBox.addEventListener("input", function () {
        let query = searchBox.value.trim();
        if (query.length < 2) {
            searchResults.innerHTML = "";  // Clear results if query is too short
            searchResults.style.display = "none";  // Hide results container
            return;
        }

        fetch(`/services/search/?q=${query}`)  // Fetch search results from the backend
            .then(response => response.json())
            .then(data => {
                searchResults.innerHTML = "";  // Clear previous results
                if (data.results.length > 0) {
                    searchResults.style.display = "block";  // Show results container
                    data.results.forEach(service => {
                        let item = document.createElement("a");
                        item.href = `/services/${service.id}/`;  // Link to the service detail page
                        item.className = "dropdown-item";  // Styling class for each result item
                        item.innerHTML = `
                            <strong>${service.name}</strong>
                            <br>
                            <small class="text-muted">${service.category}</small>
                        `;
                        searchResults.appendChild(item);  // Append each item to the dropdown
                    });
                } else {
                    searchResults.innerHTML = "<div class='dropdown-item text-muted'>No results found</div>";
                    searchResults.style.display = "block";  // Show "No results" message
                }
            })
            .catch(error => console.error("Error fetching search results:", error));  // Handle errors
    });

    // Hide results when clicking outside the search box or results container
    document.addEventListener("click", function (e) {
        if (!searchBox.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = "none";  // Hide the dropdown if clicked outside
        }
    });
});
</script>

{% endblock %}
