{% extends 'base.html' %}
{% block content %}
{% load static %}

<main>
  <!-- Dashboard-style Grid -->
  <section class="dashboard-grid">
    <!-- Wallet -->
    <a href="{% url 'transactions:wallet_balance' %}" class="card" data-service="Wallet Services">
      <img src="{% static 'images/fund.png' %}" alt="Wallet">
      <div class="card-content">
        <h3>Wallet Balance</h3>
        <p class="live-data" id="wallet-balance">Check your Balance</p>
      </div>
    </a>

    <!-- Airtime -->
    <a href="{% url 'services:purchase_airtime' %}" class="card" data-service="Airtime Purchase">
      <img src="{% static 'images/airtime.png' %}" alt="Airtime">
      <div class="card-content">
        <h3>Airtime Recharge</h3>
        <p class="live-data">Top-up in seconds</p>
      </div>
    </a>

    <!-- Data -->
    <a href="{% url 'services:data_topup' %}" class="card" data-service="Data Top-up">
      <img src="{% static 'images/data_service.png' %}" alt="Data">
      <div class="card-content">
        <h3>Data Top-up</h3>
        <p class="live-data">Check bundle offers</p>
      </div>
    </a>

    <!-- Electricity -->
    <a href="{% url 'services:electricity_payment' %}" class="card" data-service="Electricity">
      <img src="{% static 'images/electricity.png' %}" alt="Electricity">
      <div class="card-content">
        <h3>Electricity</h3>
        <p class="live-data" id="electricity-bill">Next bill: Loading...</p>
      </div>
    </a>

    <!-- TV Subscriptions -->
    <div class="card" data-service="TV Subscriptions">
      <a href="{% url 'services:dstv_payment' %}">
        <img src="{% static 'images/dstv.png' %}" alt="DSTV">
      </a>
      <a href="{% url 'services:gotv_payment' %}">
        <img src="{% static 'images/gotv.png' %}" alt="GoTV">
      </a>
      <a href="{% url 'services:startimes_payment' %}">
        <img src="{% static 'images/startimes.png' %}" alt="StarTimes">
      </a>
      <div class="card-content">
        <h3>TV Subscriptions</h3>
        <p class="live-data" id="tv-subscriptions">Subscription due soon</p>
      </div>
    </div>

    <!-- Education & Finance -->
    <div class="card" data-service="Education & Finance">
      <a href="{% url 'services:school_fees_payment' %}">
        <img src="{% static 'images/school_fees.png' %}" alt="School Fees">
      </a>
      <a href="{% url 'services:waec_result_checker' %}">
        <img src="{% static 'images/waec.jpg' %}" alt="WAEC Result">
      </a>
      <div class="card-content">
        <h3>Education</h3>
        <p class="live-data">Pay School Fees. Check WAEC Results.</p>
      </div>
    </div>

    <!-- Flight Booking -->
    <a href="{% url 'services:flight_booking' %}" class="card" data-service="Flight Booking">
      <img src="{% static 'images/flight.jpg' %}" alt="Flights">
      <div class="card-content">
        <h3>Flight Booking</h3>
        <p class="live-data" id="flight-booking">Today: 22 available</p>
      </div>
    </a>
  </section>
</main>

<!-- Info Modal -->
<div id="infoModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3 id="modal-title">Service Info</h3>
    <p id="modal-body">Loading...</p>
  </div>
</div>

<!-- Styles -->
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url("{% static 'images/background.jpg' %}") no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 2rem;
    color: #fff;
    line-height: 1.6;
    transition: background 0.5s ease;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .card {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at center, rgba(255,255,255,0.1), transparent 70%);
    transform: rotate(45deg);
    transition: opacity 0.3s ease;
    opacity: 0;
  }

  .card:hover::before {
    opacity: 1;
  }

  .card:hover {
    transform: translateY(-6px) scale(1.02);
    background: rgba(255, 255, 255, 0.12);
  }

  .card img {
    width: 64px;
    height: 64px;
    margin-bottom: 0.7rem;
    border-radius: 16px;
    transition: transform 0.3s ease;
  }

  .card:hover img {
    transform: scale(1.1);
  }

  .card-content h3 {
    font-size: 1.2rem;
    margin: 0.5rem 0;
    font-weight: 600;
    color: #ffffff;
  }

  .card-content p {
    font-size: 0.95rem;
    color: #dceefb;
    margin: 0;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 2000;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 15, 15, 0.85);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    background: #ffffff;
    color: #000;
    padding: 2rem;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    margin: 8% auto;
    position: relative;
    animation: fadeIn 0.4s ease-out;
  }

  .close-btn {
    position: absolute;
    top: 12px;
    right: 20px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    color: #888;
    transition: color 0.2s ease;
  }

  .close-btn:hover {
    color: #111;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 600px) {
    body {
      padding: 1rem;
    }

    .card img {
      width: 52px;
      height: 52px;
    }

    .modal-content {
      margin: 20% auto;
      padding: 1.2rem;
    }
  }

</style>

<!-- Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const serviceDetails = {
      "Wallet Services": "Your wallet allows you to store, send and receive funds easily. Real-time balance updates supported.",
      "Airtime Purchase": "Buy airtime for all networks instantly.",
      "Data Top-up": "Top-up your internet bundles across various networks.",
      "Electricity": "Pay electricity bills and view your recent payments.",
      "TV Subscriptions": "Manage your subscriptions for DSTV, GoTV, and StarTimes.",
      "Flight Booking": "Browse and book flights in real time from domestic and international carriers.",
      "Education & Finance": "Pay school fees securely and check your WAEC results without hassle."
    };

    const modal = document.getElementById('infoModal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const closeBtn = document.querySelector('.close-btn');

    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', () => {
        const service = card.dataset.service;
        modalTitle.textContent = service;
        modalBody.textContent = serviceDetails[service] || "Info not available.";
        modal.style.display = 'block';
      });
    });

    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Fetch live data for Wallet, Bills, etc.
    fetch('/api/wallet-summary/', {
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.balance) document.getElementById('wallet-balance').textContent = data.balance;
      if (data.next_bill) document.getElementById('electricity-bill').textContent = `Next bill: ${data.next_bill}`;
      if (data.subscriptions_due) document.getElementById('tv-subscriptions').textContent = `${data.subscriptions_due} subscriptions due soon`;
      if (data.available_flights) document.getElementById('flight-booking').textContent = `${data.available_flights} available today`;
    })
    .catch(err => {
      console.error("Error fetching wallet summary", err);
    });

    // JavaScript to Fetch Wallet Balance
    function fetchWalletBalance() {
      fetch("{% url 'transactions:wallet_balance' %}")
        .then(response => response.json())
        .then(data => {
          const walletBalanceElement = document.getElementById('wallet-balance');
          if (walletBalanceElement) {
            walletBalanceElement.textContent = 'â‚¦' + data.balance.toFixed(2); // Format to two decimal places
          }
        })
        .catch(error => console.error('Error fetching wallet balance:', error));
    }

    // Call the function to update the balance when the page loads
    fetchWalletBalance();

    // Optionally, you can set an interval to refresh the balance every few seconds
    setInterval(fetchWalletBalance, 60000); // Refresh every 1 minute
  });
</script>

{% endblock %}
